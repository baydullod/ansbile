# Step 9: Check for a new kernel and determine if a reboot is required
- name: Set next kernel to be applied
  set_fact:
    next_kernel: "{{ kernel_list.stdout_lines | select('search', '^linux-azure') | map('split', ' ') | map('last') | first | default('No new kernel available') }}"
  when: kernel_list.stdout_lines | length > 0
  tags:
    - kernel

- name: Debug next kernel to be applied
  debug:
    msg: "The next kernel to be applied is: {{ next_kernel }}"
  tags:
    - kernel

- name: Check if reboot is required (based on new kernel)
  set_fact:
    reboot_required: "{{ kernel_list.stdout_lines | length > 0 and kernel_version.stdout != next_kernel }}"
  tags:
    - kernel

- name: Show reboot required status
  debug:
    msg: "Reboot is required: {{ reboot_required }}"
  tags:
    - kernel
